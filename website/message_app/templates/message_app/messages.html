{% extends './base.html' %}
{% load static %}

{% block style %}

  <link rel="stylesheet" href="{% static 'message_app/style.css' %}">

{% endblock style %}

{% block content %}

<div class="row " style="height: 100vh;">

  {% include "message_app/contacts.html" %}

  <div class="col-8 position-relative p-0" style="height: 100vh;">

    <div class="bg-primary text-light">
      <div class="container py-3 d-flex align-items-center">
          <img src="{{ contact.profile_photo.url }}"
          width="45" height="45"
          class="rounded-circle me-2">
          <p class="ms-3 mb-0">{{ contact_name }}</p>
      </div>
    </div>

    <div
      class="container overflow-auto"
      style="
        height: calc(100vh - 170px);
        padding-top: 1rem;
        padding-bottom: 120px;
      "
    >



      {% for message in messages %}
          {% if message.sender == request.user.profile %}
              <div class="w-50 ms-auto mb-3">
                  <div class="bg-primary text-white rounded-3 p-3 shadow">
                      <p class="mb-1">{{ message.text }}</p>
                      <small class="text-white-50 d-block text-end">
                          {{ message.created_at|time:"H:i A" }}
                      </small>
                  </div>
              </div>
          {% else %}
              <div class="w-50 mb-3">
                  <div class="bg-light rounded-3 p-3 shadow">
                      <p class="mb-1">{{ message.text }}</p>
                      <small class="text-muted d-block text-start">
                          {{ message.created_at|time:"H:i A" }}
                      </small>
                  </div>
              </div>
          {% endif %}
      {% endfor %}

    </div>

    <div class="position-absolute bottom-0 start-50 translate-middle-x w-75 pb-3">
      <form action="{% url "send_message" %}" method="post" class="shadow rounded-pill overflow-hidden bg-white" id="my_form">
        {% csrf_token %}
        <div class="input-group">
          <input
            type="text"
            name="text"
            class="form-control border-0 rounded-pill rounded-end p-3"
            placeholder="message..."
          >
          <button
            id="bt"
            type="submit"
            class="btn btn-primary border-0 rounded-pill rounded-start px-4"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
              fill="currentColor" viewBox="0 0 16 16">
              <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11Z"/>
            </svg>
          </button>
        </div>
      </form>
    </div>

  </div>
</div>
<script>
  document.getElementById("bt").addEventListener("click", () => {
    const form = document.getElementById("my_form");

    const nameInput = document.createElement("input");
    nameInput.type = "hidden";
    nameInput.name = "name";
    nameInput.value = "{{contact}}";

    form.appendChild(nameInput);
    form.submit();
});
</script>

{% endblock content %}

