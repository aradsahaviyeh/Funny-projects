{% load static %}
<div class="chats-sidebar h-100 overflow-auto" style="background: white;">
  {% include 'message_app/header_chats.html' %}

  <div class="list-group list-group-flush bg-transparent">
    {% for item in chat_items %}
      <a href="{% url 'message_detail' item.profile.id %}"
         class="list-group-item list-group-item-action d-flex align-items-center gap-3 border-0 bg-transparent px-3 py-3 {% if item.profile == contact %}active bg-primary bg-opacity-10{% endif %}"
         style="border-radius: 0;">
        <div class="position-relative">
          <img src="{% if item.profile.profile_photo %}{{ item.profile.profile_photo.url }}{% else %}{% static 'images/Circle-icons-profile.svg.png' %}{% endif %}"
               class="avatar" alt="avatar">
<!--          <span class="position-absolute bottom-0 start-0 translate-middle p-1 bg-success border border-light rounded-circle" style="width: 12px; height: 12px;">بشیشب</span>-->
        </div>
        <div class="flex-grow-1 overflow-hidden">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="fw-bold mb-0 text-truncate" style="max-width: 140px;">{{ item.display_name }}</h6>
            {% if item.last_message %}
              <small class="text-secondary">{{ item.last_message.created_at|time:'H:i' }}</small>
            {% endif %}
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <small class="text-secondary text-truncate" style="max-width: 150px;">
              {% if item.last_message.sender == request.user.profile %}
                <i class="bi bi-check2"></i>
              {% endif %}
              {{ item.last_message.text|truncatechars:20 }}
            </small>
            {% if item.unread_count %}
              <span class="badge bg-primary rounded-pill">{{ item.unread_count }}</span>
            {% endif %}
          </div>
        </div>
      </a>
      {% if not forloop.last %}
        <hr class="my-0 opacity-25">
      {% endif %}
    {% empty %}
      <div class="text-center py-5">
        <i class="bi bi-chat-dots fs-1 text-primary opacity-25"></i>
        <p class="text-secondary mt-3">هنوز چتی ندارید</p>
        <a href="{% url 'contact_app:add_contact' %}" class="btn btn-sm btn-primary-gradient rounded-pill px-4">
          <i class="bi bi-plus-circle me-2"></i>افزودن مخاطب
        </a>
      </div>
    {% endfor %}
  </div>
</div>