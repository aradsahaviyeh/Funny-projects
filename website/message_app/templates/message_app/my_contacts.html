{% extends './base.html' %}
{% load static %}

{% block style %}
  <link rel="stylesheet" href="{% static 'message_app/my_contacts.css' %}" />
{% endblock %}

{% block content %}
  <div class="w-75 contact-list text-center bg-primary">
    <ul class="list-unstyled">
      {% for contact in contacts %}
          <li class="list-item bg-light"
              data-profile-id="{{ contact.contact.id }}"
              style="cursor: pointer;">
            <div class="contact-img">
              {% if contact.contact.profile_photo %}
              <img src="{{ contact.contact.profile_photo.url }}" alt="Profile photo" width="40px"/>
              {% else %}
              <img src="{% static 'message_app/images/Circle-icons-profile.svg.png' %}" alt="Default profile" width="40px"/>
              {% endif %}
            </div>
            <div>
              <p>{{ contact }}</p>
            </div>
          </li>
      {% endfor %}
    </ul>

    <button class="add-contact-btn btn bg-info text-light">افزودن مخاطب</button>
  </div>
{% endblock %}

{% block scripts %}
<script>
  // دکمه افزودن مخاطب
  let btn = document.querySelector(".add-contact-btn");
  btn.addEventListener("click", () => {
    window.location.href = "{% url 'add_contact' %}";
  });

  // Event Delegation برای مخاطبین
  document.querySelector('.contact-list').addEventListener('click', function(e) {
    // اگر روی list-item کلیک شد
    const listItem = e.target.closest('.list-item');
    if (listItem) {
      const profileId = listItem.getAttribute('data-profile-id');
      if (profileId) {
        // استفاده از URL با profile_id
        window.location.href = `/message_app/messages/${profileId}/`;
      }
    }
  });
</script>
{% endblock scripts %}